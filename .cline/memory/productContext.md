# プロダクトコンテキスト

## 解決する問題
1. 複数モニター環境での輝度調整の手間を軽減する
2. 周囲の明るさに応じた自動輝度調整の実現
3. プログラマブルな輝度制御インターフェースの提供

## 機能要件

### 1. コア機能（モニター制御）
- モニター検出・列挙
  * `EnumDisplayMonitors`を使用
  * 物理モニター情報の取得
  * モニターIDと名前の関連付け

- 輝度制御
  * 現在の輝度値取得（0-100%）
  * 輝度値設定（0-100%）
  * 全モニター一括設定

- コマンドライン操作
  ```
  brightness.exe [command] [options]
  - list: モニター一覧表示
  - get <monitor_id>: 輝度取得
  - set <monitor_id> <value>: 輝度設定
  - setall <value>: 一括設定
  ```

### 2. 自動輝度調整（BrightnessDaemon）
- タスクトレイ常駐アプリケーション
- SwitchBotセンサーによる照度検出
- 照度に基づく自動輝度調整
- ユーザー設定可能なパラメータ
  * 同期間隔
  * 最小/最大輝度
  * 照度-輝度変換カーブ

### 3. SwitchBot統合
- HTTP APIによる照度センサー値の取得
- 安全なトークン管理
- エラーハンドリングとリトライ
- テスト可能なインターフェース設計

## 技術スタック
- 言語: C++17
- SDK: Windows SDK 10.0
- ビルドツール: Visual Studio 2022, CMake
- 依存ライブラリ管理: vcpkg
- 外部ライブラリ:
  * libcurl: HTTP通信
  * OpenSSL: セキュア通信
  * nlohmann/json: JSON処理
  * GoogleTest: テストフレームワーク

## アーキテクチャ

### 1. コアコンポーネント
- MonitorController
  * モニター検出と情報取得
  * 輝度制御のコア機能

- BrightnessManager
  * 照度センサーとの連携
  * 輝度自動調整ロジック

- SwitchBotLightSensor
  * HTTP APIクライアント
  * センサーデータ取得

### 2. インターフェース
- ILightSensor
  * 照度センサー抽象化
  * テスト容易性の確保

## 制約条件

### 1. システム要件
- Windows 10/11のみ対応
- DDC/CI対応モニター必須
- 管理者権限が必要な場合あり
- インターネット接続（SwitchBot API用）

### 2. 技術的制約
- モニター応答の遅延
- 非対応モニターの存在
- ドライバー互換性の問題
- センサーデータの更新頻度

## 成功指標

### 1. 機能面
- すべてのコマンドが正常動作
- エラー時の適切なフィードバック
- 0.5秒以内の応答時間
- 照度変化への適切な追従

### 2. 品質面
- クラッシュのない安定動作
- 明確なエラーメッセージ
- メモリリークなし
- 適切なリソース管理

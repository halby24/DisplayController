# SwitchBotLightSensorエラー修正計画

## 概要
SwitchBotLightSensorプラグインのビルドエラーを修正するための計画書です。主にインクルードパスの問題と依存関係の解決に焦点を当てています。

## 修正計画

### 1. プロジェクト構造の改善

#### 1.1 相対パスの問題を解決
- `StringUtils.h`の参照を適切なインクルードパスを使用するように変更
- プラグインと共通コンポーネント間の依存関係を整理

#### 1.2 共通コンポーネントの分離
- `StringUtils`や`ConfigManager`などの共通コンポーネントを別のライブラリとして分離
- プラグインからの参照方法を標準化

### 2. 依存関係の解決

#### 2.1 メインプロジェクトのライブラリとの連携
```cmake
# 追加が必要な設定
target_link_libraries(SwitchBotLightSensor PRIVATE
    DisplayControllerCommon  # 共通ライブラリ
)
```

#### 2.2 プラグインインターフェースの整理
- プラグインのヘッダーファイルの配置場所を統一
- インターフェース定義の共有方法を標準化

### 3. ビルド設定の更新

#### 3.1 CMake設定の更新
```cmake
# インクルードパスの追加
target_include_directories(SwitchBotLightSensor PRIVATE
    ${CMAKE_SOURCE_DIR}/include  # 共通ヘッダー
    ${CMAKE_SOURCE_DIR}/src/common  # 共通コンポーネント
)
```

#### 3.2 コンパイラ設定の確認
- UTF-8エンコーディングの設定
- C++20機能の有効化
- DLLエクスポート設定

## 実装手順

### 1. 共通ライブラリの作成
1. `src/common`ディレクトリの作成
2. 共通コンポーネントの移動
3. CMake設定の追加

### 2. プラグインの修正
1. インクルードパスの更新
2. 依存関係の明示的な設定
3. ビルド設定の確認

### 3. テストの更新
1. 依存関係の変更に合わせたテストコードの修正
2. ビルド設定の確認

## 注意点
- すべてのソースファイルはUTF-8（BOMあり）で保存
- 文字列リテラルの改行は避け、1行で記述するか、文字列連結演算子を使用
- Windows APIの呼び出しはUnicode版（*W関数）に統一

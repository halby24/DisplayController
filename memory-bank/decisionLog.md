# 設計決定ログ

## 2025/3/2: プラグインアーキテクチャの採用
### 決定内容
BrightnessDaemonをプラグインベースのアーキテクチャに移行

### 理由
1. 疎結合な設計の実現
2. 新しいデバイスの追加を容易にする
3. テスト容易性の向上
4. メンテナンス性の向上

### 影響範囲
- BrightnessDaemonの構造変更
- SwitchBotLightSensorの再実装
- 設定システムの更新

### 代替案検討
1. ファクトリーパターンのみの使用
   - 却下理由：拡張性が限定的
   - 動的なプラグイン追加が困難

2. 抽象クラスベースの設計
   - 却下理由：実行時の柔軟性が低い
   - コンパイル時の依存関係が必要

### 技術的詳細
1. プラグインインターフェース
   ```cpp
   class ILightSensorPlugin {
       virtual const char* GetPluginName() const = 0;
       virtual const char* GetPluginVersion() const = 0;
       virtual std::unique_ptr<ILightSensor> CreateSensor(
           const json& config
       ) = 0;
   };
   ```

2. プラグインローダー
   - 動的ライブラリとして実装
   - 設定ファイルベースの構成
   - エラーハンドリング機能

## 2025/3/2: プラグイン実装の完了
### 決定内容
SwitchBotLightSensorとDummyLightSensorをプラグインとして実装

### 実装詳細
1. プラグインの構造
   - 各プラグインは独立したディレクトリとCMakeプロジェクト
   - インターフェース実装クラスと具体的なセンサークラスを分離
   - 共通のビルド設定とインストールルール

2. 設定形式
   ```json
   {
       "sensor": {
           "plugin": "プラグイン名",
           "config": {
               // プラグイン固有の設定
           }
       }
   }
   ```

3. エラーハンドリング
   - プラグインローダーでの例外処理
   - フォールバックメカニズム（DummyLightSensor）
   - 詳細なエラーメッセージ

### 今後の課題
1. セキュリティ
   - プラグインの署名検証システム
   - 設定ファイルの検証
   - プラグインの権限管理

2. パフォーマンス
   - プラグイン読み込みの最適化
   - リソース使用量の監視
   - キャッシング戦略

3. メンテナンス
   - プラグイン開発ガイドライン
   - バージョン管理ポリシー
   - 後方互換性の維持

### フォローアップ
1. テスト計画の策定
2. ドキュメントの整備
3. パフォーマンス計測の実施
